var JsBusterManager=(function(){var m_reportCategory="default";var m_jsVersion="unknown";var m_fbId=0;var m_browserInfo={};var m_skipBrowserInfo={};var m_gatheredPlayerInfo={};var m_isInitialized=false;var m_showingSuccessASWindowCallbackName;var m_showingFailureASWindowCallbackName;var m_getFlashMemoryUsageCallbackName;var m_getFlashVersionCallbackName;var m_maxSuccessReportNumPerPeriod;var m_maxFailureReportNumPerPeriod;var m_successReportCounter=0;var m_failureReportCounter=0;var JSBUSTER_STAT_COUNTER="jsbuster";var m_downloadImageUrl="";var m_downloadImageSizeByByte=0;return{init:function(fbId,reportCategory,jsVersion,showingSuccessASWindowCallbackName,showingFailureASWindowCallbackName,getFlashMemoryUsageCallbackName,getFlashVersionCallbackName,maxSuccessReportNumPerPeriod,maxFailureReportNumPerPeriod,jsBusterDownloadImageUrl,jsBusterDownloadImageSizeByByte){if(reportCategory!=undefined&&reportCategory!=""){m_reportCategory=reportCategory}if(jsVersion!=undefined&&jsVersion!=""){m_jsVersion=jsVersion}if(fbId!=undefined&&fbId!=""){m_fbId=fbId}if(jsBusterDownloadImageUrl!=undefined&&jsBusterDownloadImageUrl!=""){m_downloadImageUrl=jsBusterDownloadImageUrl}if(jsBusterDownloadImageSizeByByte!=undefined&&jsBusterDownloadImageSizeByByte!=""){m_downloadImageSizeByByte=jsBusterDownloadImageSizeByByte}m_showingSuccessASWindowCallbackName=showingSuccessASWindowCallbackName;m_showingFailureASWindowCallbackName=showingFailureASWindowCallbackName;m_getFlashMemoryUsageCallbackName=getFlashMemoryUsageCallbackName;m_getFlashVersionCallbackName=getFlashVersionCallbackName;m_maxSuccessReportNumPerPeriod=maxSuccessReportNumPerPeriod;m_maxFailureReportNumPerPeriod=maxFailureReportNumPerPeriod;JsBusterManager.setTagInfo("category",m_reportCategory);m_browserInfo.location=location;m_browserInfo.screen=screen;m_browserInfo.navigator=navigator;m_skipBrowserInfo.window={parent:true,history:true,location:true,navigator:true,screen:true,self:true,top:true,window:true,document:true,FB:true};m_skipBrowserInfo.location={};m_skipBrowserInfo.navigator={};m_skipBrowserInfo.screen={};m_skipBrowserInfo.navigator["plugins"]=true;m_skipBrowserInfo.navigator["mimeTypes"]=true;m_isInitialized=true},showFailureReportConfirmationASWindow:function(externalReference){if(m_isInitialized===true){if(m_maxFailureReportNumPerPeriod>m_failureReportCounter){m_failureReportCounter++;try{eval("document.getElementById('flashapp')."+m_showingFailureASWindowCallbackName+'("'+externalReference+'");');FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"success","jsBusterManager(js)","showFailureReportConfirmationASWindow","FailureASWindowCallbackIsCalled")}catch(error){var errorMessage="";if(error.message!=undefined&&error.message!=""){errorMessage=error.message}FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","showFailureReportConfirmationASWindow","CouldNotCallASCallbackFunction",errorMessage)}}}else{FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","showFailureReportConfirmationASWindow","jsBusterManagerIsNotInitialized")}},showSuccessReportConfirmationASWindow:function(){if(m_isInitialized===true){if(m_maxSuccessReportNumPerPeriod>m_successReportCounter){if(m_failureReportCounter>0){m_successReportCounter++;try{eval("document.getElementById('flashapp')."+m_showingSuccessASWindowCallbackName+"();");FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"success","jsBusterManager(js)","showSuccessReportConfirmationASWindow","SuccessASWindowCallbackIsCalled")}catch(error){var errorMessage="";if(error.message!=undefined&&error.message!=""){errorMessage=error.message}FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","showSuccessReportConfirmationASWindow","CouldNotCallASCallbackFunction",errorMessage)}}}}else{FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","showSuccessReportConfirmationASWindow","jsBusterManagerIsNotInitialized")}},resetReportInfo:function(){m_gatheredPlayerInfo={};JsBusterManager.setTagInfo("category",m_reportCategory)},setInfoOnGatheredPlayerInfo:function(category,attrName,attrValue){if(category!=undefined&&category!=""&&attrName!=undefined&&attrName!=""&&attrValue!=undefined&&attrValue!=""){if(m_gatheredPlayerInfo[category]==undefined||m_gatheredPlayerInfo[category]==null){m_gatheredPlayerInfo[category]={}}if(m_gatheredPlayerInfo[category][attrName]==undefined||m_gatheredPlayerInfo[category][attrName]==null){m_gatheredPlayerInfo[category][attrName]={}}m_gatheredPlayerInfo[category][attrName]=attrValue}else{FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","setInfoOnGatheredPlayerInfo","passParametersIsNotValid")}},setJSInfo:function(attrName,attrValue){JsBusterManager.setInfoOnGatheredPlayerInfo("js",attrName,attrValue)},setTagInfo:function(attrName,attrValue){JsBusterManager.setInfoOnGatheredPlayerInfo("tag",attrName,attrValue)},setFbInfo:function(attrName,attrValue){JsBusterManager.setInfoOnGatheredPlayerInfo("fb",attrName,attrValue)},setDomContentInfo:function(attrName,attrValue){JsBusterManager.setInfoOnGatheredPlayerInfo("dom",attrName,attrValue)},setTimeInfo:function(attrName,attrValue){JsBusterManager.setInfoOnGatheredPlayerInfo("time",attrName,attrValue)},setExtraInfo:function(attrName,attrValue){JsBusterManager.setInfoOnGatheredPlayerInfo("extra",attrName,attrValue)},getBrowserObjectSize:function(browserObject){var result=0;if(browserObject!=undefined&&browserObject!=""){var index;for(index in browserObject){if(index!=undefined&&index!=""){result++}}}return result},gatherPlayerInfo:function(){var errorMessage="";try{JsBusterManager.player.gatherJSVersionInfo()}catch(error){if(error.message!=undefined&&error.message!=""){errorMessage=error.message}FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","gatherPlayerInfo","couldNotCallgatherJSVersionInfo",errorMessage);errorMessage=""}try{JsBusterManager.player.gatherFbInfo()}catch(error){if(error.message!=undefined&&error.message!=""){errorMessage=error.message}FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","gatherPlayerInfo","couldNotCallgatherFbInfo",errorMessage);errorMessage=""}try{JsBusterManager.player.gatherBrowserInfo()}catch(error){if(error.message!=undefined&&error.message!=""){errorMessage=error.message}FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","gatherPlayerInfo","couldNotCallgatherBrowserInfo",errorMessage);errorMessage=""}try{JsBusterManager.player.gatherPlayerTimeInfo()}catch(error){if(error.message!=undefined&&error.message!=""){errorMessage=error.message}FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","gatherPlayerInfo","couldNotCallgatherPlayerTimeInfo",errorMessage);errorMessage=""}try{JsBusterManager.player.gatherCurrentWindowDocumentInfo()}catch(error){if(error.message!=undefined&&error.message!=""){errorMessage=error.message}FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","gatherPlayerInfo","couldNotCallgatherCurrentWindowDocumentInfo",errorMessage);errorMessage=""}try{JsBusterManager.player.gatherParentWindowDocumentInfo()}catch(error){if(error.message!=undefined&&error.message!=""){errorMessage=error.message}FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","gatherPlayerInfo","couldNotCallgatherParentWindowDocumentInfo",errorMessage);errorMessage=""}try{JsBusterManager.player.gatherBrowserHistoryLengthInfo()}catch(error){if(error.message!=undefined&&error.message!=""){errorMessage=error.message}FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","gatherPlayerInfo","couldNotCallgatherBrowserHistoryLengthInfo",errorMessage);errorMessage=""}try{JsBusterManager.player.gatherFlashTotalMemoryUsageInfo()}catch(error){if(error.message!=undefined&&error.message!=""){errorMessage=error.message}FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","gatherPlayerInfo","couldNotCallgatherFlashTotalMemoryUsageInfo",errorMessage);errorMessage=""}try{JsBusterManager.player.gatherFlashVersionInfo()}catch(error){if(error.message!=undefined&&error.message!=""){errorMessage=error.message}FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","gatherPlayerInfo","couldNotCallgatherFlashVersionInfo",errorMessage);errorMessage=""}FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"info","jsBusterManager(js)","gatherPlayerInfo","functionCalled")},getGatheredPlayerInfo:function(){FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"info","jsBusterManager(js)","getGatheredPlayerInfo","functionCalled");return JSON.stringify(m_gatheredPlayerInfo)},player:{gatherDownloadSpeed:function(){function downloadDoneCallback(){var downloadSpeedKbps=0;var durationBySeconds=(endTime-startTime)/1000;var imageSizeByBit=m_downloadImageSizeByByte*8;downloadSpeedKbps=((imageSizeByBit/durationBySeconds)/1024).toFixed(2);JsBusterManager.setTagInfo("downloadspeed",downloadSpeedKbps)}if(m_downloadImageUrl!=undefined&&m_downloadImageUrl!=""){if(m_downloadImageSizeByByte!=undefined&&m_downloadImageSizeByByte!=""){var startTime,endTime;var downloadImage=new Image();var dateObj=new Date();downloadImage.onload=function(){endTime=dateObj.getTime();result=downloadDoneCallback()};startTime=dateObj.getTime();downloadImage.src=m_downloadImageUrl+"?n="+Math.random()}}},gatherJSVersionInfo:function(){JsBusterManager.setJSInfo("version",m_jsVersion)},gatherBrowserHistoryLengthInfo:function(){if(history!=undefined&&history!=""){if(history.length!=undefined&&history.length!=""){if(m_gatheredPlayerInfo.browser.history==undefined||m_gatheredPlayerInfo.browser.history==null){m_gatheredPlayerInfo.browser.history={}}m_gatheredPlayerInfo.browser.history["length"]=history.length}else{FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","gatherBrowserHistoryLengthInfo","history.lengthObjectIsNotDefined")}}else{FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","gatherBrowserHistoryLengthInfo","historyObjectIsNotDefined")}},gatherFlashTotalMemoryUsageInfo:function(){var currentMemoryUsageByByte=0;if(m_getFlashMemoryUsageCallbackName!=undefined&&m_getFlashMemoryUsageCallbackName!=""){if(m_gatheredPlayerInfo.browser.flash==undefined||m_gatheredPlayerInfo.browser.flash==null){m_gatheredPlayerInfo.browser.flash={}}try{FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"info","jsBusterManager(js)","gatherFlashTotalMemoryUsageInfo","functionCalled");currentMemoryUsageByByte=eval("document.getElementById('flashapp')."+m_getFlashMemoryUsageCallbackName+"();")}catch(error){var errorMessage="";if(error.message!=undefined&&error.message!=""){errorMessage=error.message}FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","gatherFlashTotalMemoryUsageInfo","CouldNotCallASCallbackFunction",errorMessage)}m_gatheredPlayerInfo.browser.flash["memory"]=currentMemoryUsageByByte}else{FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","gatherFlashTotalMemoryUsageInfo","m_getFlashMemoryUsageCallbackNameIsNotDefined")}},gatherFlashVersionInfo:function(){var currentFlashVersion="unknown";if(m_getFlashVersionCallbackName!=undefined&&m_getFlashVersionCallbackName!=""){if(m_gatheredPlayerInfo.browser.flash==undefined||m_gatheredPlayerInfo.browser.flash==null){m_gatheredPlayerInfo.browser.flash={}}try{FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"info","jsBusterManager(js)","gatherFlashVersionInfo","functionCalled");currentFlashVersion=eval("document.getElementById('flashapp')."+m_getFlashVersionCallbackName+"();")}catch(error){var errorMessage="";if(error.message!=undefined&&error.message!=""){errorMessage=error.message}FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","gatherBrowserHistoryLengthInfo","CouldNotCallASCallbackFunction",errorMessage)}m_gatheredPlayerInfo.browser.flash["version"]=currentFlashVersion}else{FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","gatherFlashVersionInfo","m_getFlashVersionCallbackNameIsNotDefined")}},gatherCurrentWindowDocumentInfo:function(){var documentContent=undefined;if(typeof self!="undefined"&&self!=undefined&&self!=""){if(typeof self.document!="undefined"&&self.document!=undefined&&self.document!=""){if(typeof self.document.documentElement!="undefined"&&self.document.documentElement!=undefined&&self.document.documentElement!=""){documentContent=self.document.documentElement.innerHTML;if(documentContent!=undefined&&documentContent!=""){JsBusterManager.setDomContentInfo("currentWindowDocument",documentContent)}}else{FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","gatherCurrentWindowDocumentInfo","self.document.documentElementIsNotDefined")}}else{FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","gatherCurrentWindowDocumentInfo","self.documentIsNotDefined")}}else{FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","gatherCurrentWindowDocumentInfo","selfIsNotDefined")}},gatherParentWindowDocumentInfo:function(){var documentContent=undefined;if(typeof parent!="undefined"&&parent!=undefined&&parent!=""){if(typeof parent.document!="undefined"&&parent.document!=undefined&&parent.document!=""){if(typeof parent.document.documentElement!="undefined"&&parent.document.documentElement!=undefined&&parent.document.documentElement!=""){documentContent=parent.document.documentElement.innerHTML;if(documentContent!=undefined&&documentContent!=""){JsBusterManager.setDomContentInfo("parentWindowDocument",documentContent)}}else{FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","gatherParentWindowDocumentInfo","parent.document.documentElementIsNotDefined")}}else{FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","gatherParentWindowDocumentInfo","parent.documentIsNotDefined")}}else{FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","gatherParentWindowDocumentInfo","parentIsNotDefined")}},gatherPlayerTimeInfo:function(){var dateObj=new Date();if(dateObj!=undefined&&dateObj!=""&&Math!=undefined&&Math!=""){var unixTimestamp=0;if(typeof Math.round=="function"&&typeof dateObj.getTime=="function"){unixTimestamp=Math.round(dateObj.getTime()/1000)}else{FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","gatherPlayerTimeInfo","dateObjOrMathIsNotFunction")}JsBusterManager.setTimeInfo("user",unixTimestamp)}else{FarmNS.StatsManager.count(JSBUSTER_STAT_COUNTER,"error","jsBusterManager(js)","gatherPlayerTimeInfo","dateObjOrMathIsNotDefined")}delete dateObj},gatherBrowserInfo:function(){if(JsBusterManager.getBrowserObjectSize(m_browserInfo)>0){for(browserObjIndex in m_browserInfo){var browserObj=m_browserInfo[browserObjIndex];if(JsBusterManager.getBrowserObjectSize(browserObj)>0){for(index in browserObj){if(index!=undefined&&index!=""){if(browserObj[index]!=undefined&&browserObj[index]!=""&&typeof browserObj[index]!="function"){if(m_skipBrowserInfo[browserObjIndex]!=undefined&&(m_skipBrowserInfo[browserObjIndex][index]!=true)){if(m_gatheredPlayerInfo.browser==undefined||m_gatheredPlayerInfo.browser==null){m_gatheredPlayerInfo.browser={}}if(m_gatheredPlayerInfo.browser[browserObjIndex]==undefined||m_gatheredPlayerInfo.browser[browserObjIndex]==null){m_gatheredPlayerInfo.browser[browserObjIndex]={}}m_gatheredPlayerInfo.browser[browserObjIndex][index]=browserObj[index]}}}}}}}},gatherFbInfo:function(){JsBusterManager.setFbInfo("idFromBrowser",m_fbId);if(FB!=undefined&&FB!=""){if(FB.getLoginStatus!=undefined&&typeof FB.getLoginStatus=="function"){FB.getLoginStatus(function(response){JsBusterManager.setFbInfo("getLoginStatus",response)})}if(FB.api!=undefined&&typeof FB.api=="function"){JsBusterManager.setFbInfo("fbApi",JSON.stringify(FB.api))}else{JsBusterManager.setFbInfo("fbApi","null/notFunction")}if(FB.ui!=undefined&&typeof FB.ui=="function"){JsBusterManager.setFbInfo("fbUi",JSON.stringify(FB.ui))}else{JsBusterManager.setFbInfo("fbUi","null/notFunction")}}}}}})();