
// need to include prebid file in <head> "https://ads.rubiconproject.com/prebid/8735.js"
// need to include the Google URL in the <head> "//www.googletagservices.com/tag/js/gpt.js"


var google_dfp_slot_prepend =  "/98884801/";


var google_dfp_slot_info =  [{
    "slot": "WEB_FARM1_300",
    "height": "250",
    "width": "300",
    "id": "div-gpt-ad-1530904043061-1",
    "parent_id": "zap-300-1"
},{
    "slot": "WEB_FARM1_300R",
    "height": "250",
    "width": "300",
    "id": "div-gpt-ad-1530904043061-3",
    "parent_id": "zap-300-3"
},{
    "slot": "WEB_FARM1_300C",
    "height": "300",
    "width": "400",
    "id": "div-gpt-ad-1530904043061-0",
    "parent_id": "zap-350-2"
},{
    "slot": "WEB_FARM1_728T",
    "height": "90",
    "width": "728",
    "id": "div-gpt-ad-1530904043061-4",
    "parent_id": "zap-728"
},{
    "slot": "WEB_FARM1_728B",
    "height": "90",
    "width": "728",
    "id": "div-gpt-ad-1530904043061-2",
    "parent_id": "zap-FB_FARM_BAN_728_90"
}]





var w = window;
var pbjs = w.pbjs || {};
pbjs.que = pbjs.que || [];
var allSlots = [];
var WEB_FARM_400M_SLOT_NAME = 'WEB_FARM1_300C';
var WEB_FARM_400M_SLOT = [];
var googletag = w.googletag || {};
googletag.cmd = googletag.cmd || [];
var PREBID_TIMEOUT = this.prebidTimeout;
var slotsToRefresh = [];


var refreshAllSlots = true;

function sendAdserverRequest() {
    //if (pbjs.adserverRequestSent) {
    //    console.log("Loading ad req sent");
    //    return;
    //}
    //pbjs.adserverRequestSent = true;
    googletag.cmd.push(function () {
        googletag.pubads().refresh(slotsToRefresh);
        if (refreshAllSlots) {
            googletag.pubads().refresh(slotsToRefresh);
        } else {
            googletag.pubads().refresh(WEB_FARM_400M_SLOT);
        }
        refreshAllSlots = !refreshAllSlots;
        //console.log("Loading ad refresh");
        //pbjs.que.push(function () {
        //    pbjs.setTargetingForGPTAsync();
        //    googletag.pubads().refresh(slotsToRefresh);
        //    console.log("Loading ad refresh");
        //    //if (refreshAllSlots) {
        //    //    googletag.pubads().refresh(slotsToRefresh);
        //    //} else {
        //    //    googletag.pubads().refresh(WEB_WWF2_400M_SLOT);
        //    //}
        //    //refreshAllSlots = !refreshAllSlots;
        //});
        //});
    });
}

setTimeout(sendAdserverRequest, PREBID_TIMEOUT);

setInterval(function () {
    googletag.cmd.push(function () {
        googletag.pubads().disableInitialLoad();
    });
    setTimeout(function () {
        sendAdserverRequest();
    }, PREBID_TIMEOUT);

    googletag.cmd.push(function () {
        googletag.pubads().set("page_url", "https://www.zynga.com/games/farmville");
        googletag.enableServices();
    });


    //sendAdserverRequest();
    //googletag.cmd.push(function () {
    //    googletag.pubads().refresh();
    //});
}, 50 * 1000);

googletag.cmd.push(function () {
    if (Object.keys(googletag).length) {
        var googleSlotsInfo = google_dfp_slot_info;

        for (var i = 0; i < googleSlotsInfo.length; i++) {
            //var googleSlotDiv ;
            //googleSlotDiv = s5.Dom.div({
            //    id: googleSlotsInfo[i].id,
            //    parent: document.getElementById(googleSlotsInfo[i].parent_id)
            //});
            //googleSlotDiv.style.width = googleSlotsInfo[i].width + 'px';
            //googleSlotDiv.style.height = googleSlotsInfo[i].height + 'px';

            var newDiv = document.createElement("div");
            newDiv.style.width = googleSlotsInfo[i].width + 'px';
            newDiv.style.height = googleSlotsInfo[i].height + 'px';
            newDiv.id = googleSlotsInfo[i].id;
            newDiv.parentNode = document.getElementById(googleSlotsInfo[i].parent_id);
            var parentdiv = document.getElementById(googleSlotsInfo[i].parent_id);
            if(parentdiv) {
                googleSlotDiv = newDiv
                parentdiv.appendChild(googleSlotDiv);
                googletag.pubads()
                allSlots[i] = googletag.defineSlot(google_dfp_slot_prepend + googleSlotsInfo[i].slot, [parseInt(googleSlotsInfo[i].width), parseInt(googleSlotsInfo[i].height)], googleSlotsInfo[i].id).setTargeting(googleSlotsInfo[i].slot, "refresh").addService(googletag.pubads());
                googletag.pubads().set("page_url", "https://www.zynga.com/games/farmville");
                googletag.enableServices();
            }

        }

        var j = 0;
        for (var k = 0; k < googleSlotsInfo.length; k++) {
            googletag.display(googleSlotsInfo[k].id);
            slotsToRefresh[j++] = allSlots[k];
            if (googleSlotsInfo[k].slot === WEB_FARM_400M_SLOT_NAME) {
                WEB_FARM_400M_SLOT[0] = allSlots[k];
            }
        }
    }
});




